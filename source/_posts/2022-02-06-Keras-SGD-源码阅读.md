---
title: 2022-02-06-Keras SGD 源码阅读
date: 2022-02-06 17:15:23
tags:
categories:
---

摘要

<!-- more -->


正文

```python
# SGD代码核心位置 keras.optimizer_v1.SGD 
# SGD的核心代码如下  

def get_updates(self, loss, params):
  grads = self.get_gradients(loss, params)
  self.updates = [tf.compat.v1.assign_add(self.iterations, 1)]

  lr = self.lr
  if self.initial_decay > 0:
    lr = lr * (  # pylint: disable=g-no-augmented-assignment
        1. /
        (1. +
         self.decay * tf.cast(self.iterations,
                                    backend.dtype(self.decay))))
  # momentum
  moments = self._create_all_weights(params)
  for p, g, m in zip(params, grads, moments):
    v = self.momentum * m - lr * g  # velocity
    self.updates.append(tf.compat.v1.assign(m, v))

    if self.nesterov:
      new_p = p + self.momentum * v - lr * g
    else:
      new_p = p + v

    # Apply constraints.
    if getattr(p, 'constraint', None) is not None:
      new_p = p.constraint(new_p)

    self.updates.append(tf.compat.v1.assign(p, new_p))
  return self.updates

```


## 参考资料

1. keras.optimizer_v1.SGD 
2. [Question about Nesterov momentum implementation · Issue #14115 · keras-team/keras](https://github.com/keras-team/keras/issues/14115)
3. [CS231n Convolutional Neural Networks for Visual Recognition](https://cs231n.github.io/neural-networks-3/#sgd)
4. [Nesterov based gradient descent · Issue #966 · keras-team/keras](https://github.com/keras-team/keras/issues/966)
2. [New PR for Nesterov change by the-moliver · Pull Request #47 · pluskid/Mocha.jl](https://github.com/pluskid/Mocha.jl/pull/47)
