---
title: 2022-02-06-Keras SGD 源码阅读
date: 2022-02-06 17:15:23
tags:
categories: 算法论文系列
mathjax: true
---

摘要

<!-- more -->

-------------------------


目录如下
- [1. 缘起](#1-缘起)
- [2. 现象](#2-现象)
- [3. 分析原因](#3-分析原因)
    - [3.1. 有人提出相同的问题](#31-有人提出相同的问题)
    - [3.2. 一些解释](#32-一些解释)
    - [3.3. 我的理解](#33-我的理解)
- [4. 参考资料](#4-参考资料)

# 1. 缘起


Keras代码中 nesterov SGD算法的实现看起来和一些论文、博客中的公式不相同。


# 2. 现象

核心代码块

```python
# from keras code: keras.optimizer_v1.SGD 
for p, g, m in zip(params, grads, moments):
    v = self.momentum * m - lr * g    # velocity
    self.updates.append(tf.compat.v1.assign(m, v))
    if self.nesterov:
        new_p = p + self.momentum * v - lr * g
    else:
        new_p = p + v
```

# 3. 分析原因

## 3.1. 有人提出相同的问题

1. [Question about Nesterov momentum implementation · Issue #14115 · keras-team/keras](https://github.com/keras-team/keras/issues/14115)
2. [Nesterov based gradient descent · Issue #966 · keras-team/keras](https://github.com/keras-team/keras/issues/966)
3. [New PR for Nesterov change by the-moliver · Pull Request #47 · pluskid/Mocha.jl](https://github.com/pluskid/Mocha.jl/pull/47)

## 3.2. 一些解释

查找到的一些对该问题的解释和对这种方法的阐述。

1. 一些相关的课程
    1. [CS231n Convolutional Neural Networks for Visual Recognition](https://cs231n.github.io/neural-networks-3/#sgd)
    2. [ADVANCES IN OPTIMIZING RECURRENT NETWORKS 1212.0901v2.pdf](https://arxiv.org/pdf/1212.0901v2.pdf )
2. [比Momentum更快：揭开Nesterov Accelerated Gradient的真面目 - 知乎](https://zhuanlan.zhihu.com/p/22810533)

## 3.3. 我的理解

1. 本质上 是用了公式 $\hat{d_i} = \beta^2 d_{i-1} + (\beta + 1) g(\theta_{i-1})$


# 4. 参考资料

1. [Question about Nesterov momentum implementation · Issue #14115 · keras-team/keras](https://github.com/keras-team/keras/issues/14115)
2. [CS231n Convolutional Neural Networks for Visual Recognition](https://cs231n.github.io/neural-networks-3/#sgd)
3. [Nesterov based gradient descent · Issue #966 · keras-team/keras](https://github.com/keras-team/keras/issues/966)
4. [New PR for Nesterov change by the-moliver · Pull Request #47 · pluskid/Mocha.jl](https://github.com/pluskid/Mocha.jl/pull/47)
